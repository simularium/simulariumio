#!/usr/bin/env python
# -*- coding: utf-8 -*-

import numpy as np
import pytest

from simulariumio.physicell import PhysicellConverter, PhysicellData
from simulariumio import MetaData, DisplayData, JsonWriter, DISPLAY_TYPE, UnitData
from simulariumio.constants import DEFAULT_CAMERA_SETTINGS, CURRENT_VERSION
from simulariumio.tests.conftest import assert_buffers_equal


@pytest.mark.parametrize(
    "trajectory, expected_data",
    [
        # 3 cells 3 frames
        (
            PhysicellData(
                meta_data=MetaData(
                    box_size=np.array([1000.0, 1000.0, 100.0]),
                    scale_factor=0.01,
                ),
                timestep=360.0,
                path_to_output_dir="simulariumio/tests/data/physicell/output/",
                display_data={
                    0: DisplayData(
                        name="Cancer cell",
                        display_type=DISPLAY_TYPE.SPHERE,
                        radius=30.0,
                        color="#0080ff",
                    ),
                },
                phase_names={1: {4: "interphase"}},
            ),
            {
                "trajectoryInfo": {
                    "version": CURRENT_VERSION.TRAJECTORY_INFO,
                    "timeUnits": {
                        "magnitude": 1.0,
                        "name": "s",
                    },
                    "timeStepSize": 360.0,
                    "totalSteps": 3,
                    "spatialUnits": {
                        "magnitude": 100.0,
                        "name": "µm",
                    },
                    "size": {"x": 10.0, "y": 10.0, "z": 1.0},
                    "cameraDefault": {
                        "position": {
                            "x": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[2],
                        },
                        "lookAtPosition": {
                            "x": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[2],
                        },
                        "upVector": {
                            "x": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[0],
                            "y": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[1],
                            "z": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[2],
                        },
                        "fovDegrees": DEFAULT_CAMERA_SETTINGS.FOV_DEGREES,
                    },
                    "typeMapping": {
                        "0": {
                            "name": "cell1#interphase",
                            "geometry": {
                                "displayType": "SPHERE",
                            },
                        },
                        "1": {
                            "name": "Cancer cell#phase4",
                            "geometry": {
                                "displayType": "SPHERE",
                                "color": "#0080ff",
                            },
                        },
                    },
                },
                "spatialData": {
                    "version": CURRENT_VERSION.SPATIAL_DATA,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 3,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -4.2700000000000005,
                                -2.5100000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 360.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -4.247925822013689,
                                -2.386576945662163,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                        {
                            "frameNumber": 2,
                            "time": 720.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -3.993800168730208,
                                -2.5387508185531873,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                    ],
                },
                "plotData": {"version": CURRENT_VERSION.PLOT_DATA, "data": []},
            },
        ),
        # 3 cells 1 frame
        (
            PhysicellData(
                timestep=360.0,
                path_to_output_dir="simulariumio/tests/data/physicell/output/",
                meta_data=MetaData(
                    box_size=np.array([1000.0, 1000.0, 100.0]),
                    scale_factor=0.01,
                ),
                nth_timestep_to_read=2,
                display_data={
                    0: DisplayData(
                        name="Cancer cell",
                        display_type=DISPLAY_TYPE.SPHERE,
                        radius=30.0,
                        color="#0080ff",
                    ),
                },
                phase_names={1: {4: "interphase"}},
            ),
            {
                "trajectoryInfo": {
                    "version": CURRENT_VERSION.TRAJECTORY_INFO,
                    "timeUnits": {
                        "magnitude": 1.0,
                        "name": "s",
                    },
                    "timeStepSize": 720.0,
                    "totalSteps": 2,
                    "spatialUnits": {
                        "magnitude": 100.0,
                        "name": "µm",
                    },
                    "size": {"x": 10.0, "y": 10.0, "z": 1.0},
                    "cameraDefault": {
                        "position": {
                            "x": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[2],
                        },
                        "lookAtPosition": {
                            "x": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[2],
                        },
                        "upVector": {
                            "x": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[0],
                            "y": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[1],
                            "z": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[2],
                        },
                        "fovDegrees": DEFAULT_CAMERA_SETTINGS.FOV_DEGREES,
                    },
                    "typeMapping": {
                        "0": {
                            "name": "cell1#interphase",
                            "geometry": {
                                "displayType": "SPHERE",
                            },
                        },
                        "1": {
                            "name": "Cancer cell#phase4",
                            "geometry": {
                                "displayType": "SPHERE",
                                "color": "#0080ff",
                            },
                        },
                    },
                },
                "spatialData": {
                    "version": CURRENT_VERSION.SPATIAL_DATA,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 2,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -4.2700000000000005,
                                -2.5100000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 720.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -3.993800168730208,
                                -2.5387508185531873,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                    ],
                },
                "plotData": {"version": CURRENT_VERSION.PLOT_DATA, "data": []},
            },
        ),
        pytest.param(
            {
                "meta_data": MetaData(
                    box_size=np.array([1000.0, 1000.0, 100.0]),
                    scale_factor=0.01,
                ),
                "timestep": 360.0,
                "path_to_output_dir": "../simulariumio/tests/data/physicell/",
            },
            {},
            marks=pytest.mark.raises(exception=AttributeError),
            # path_to_output_dir is incorrect
        ),
        # metaballs
        (
            PhysicellData(
                meta_data=MetaData(
                    box_size=np.array([960.0, 640.0, 300.0]),
                    scale_factor=0.01,
                ),
                timestep=36.0,
                path_to_output_dir="simulariumio/tests/data/physicell/subcell_output/",
                display_data={
                    0: DisplayData(
                        name="Substrate",
                        display_type=DISPLAY_TYPE.SPHERE,
                        color="#d0c5c8",
                    ),
                },
                phase_names={0: {18: "fixed"}},
                max_owner_cells=10000,
                owner_cell_display_name="Stem cell",
                time_units=UnitData("min"),
            ),
            {
                "trajectoryInfo": {
                    "version": CURRENT_VERSION.TRAJECTORY_INFO,
                    "timeUnits": {
                        "magnitude": 1.0,
                        "name": "min",
                    },
                    "timeStepSize": 36.0,
                    "totalSteps": 3,
                    "spatialUnits": {
                        "magnitude": 100.0,
                        "name": "µm",
                    },
                    "size": {"x": 9.6, "y": 6.4, "z": 3.0},
                    "cameraDefault": {
                        "position": {
                            "x": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[2],
                        },
                        "lookAtPosition": {
                            "x": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[2],
                        },
                        "upVector": {
                            "x": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[0],
                            "y": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[1],
                            "z": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[2],
                        },
                        "fovDegrees": DEFAULT_CAMERA_SETTINGS.FOV_DEGREES,
                    },
                    "typeMapping": {
                        "0": {
                            "name": "Substrate#fixed",
                            "geometry": {
                                "displayType": "SPHERE",
                                "color": "#d0c5c8",
                            },
                        },
                        "1": {
                            "name": "Stem cell#8",
                            "geometry": {
                                "displayType": "METABALLS",
                            },
                        },
                        "2": {
                            "name": "Stem cell#14",
                            "geometry": {
                                "displayType": "METABALLS",
                            },
                        },
                        "3": {
                            "name": "Stem cell#25",
                            "geometry": {
                                "displayType": "METABALLS",
                            },
                        },
                        "4": {
                            "name": "Stem cell#2",
                            "geometry": {
                                "displayType": "METABALLS",
                            },
                        },
                    },
                },
                "spatialData": {
                    "version": CURRENT_VERSION.SPATIAL_DATA,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 3,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.0,
                            "data": [
                                1000,
                                35,
                                0,
                                4.3983198,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                36,
                                0,
                                4.701652200000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                37,
                                0,
                                5.0049846,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                38,
                                0,
                                5.308317000000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                39,
                                0,
                                4.2466536,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                40,
                                0,
                                4.5499860000000005,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                41,
                                0,
                                4.8533184,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                42,
                                0,
                                5.1566508,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                43,
                                0,
                                4.3983198,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                44,
                                0,
                                4.701652200000001,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                45,
                                0,
                                5.0049846,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                46,
                                0,
                                5.308317000000001,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                47,
                                0,
                                4.2466536,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                48,
                                0,
                                4.5499860000000005,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                49,
                                0,
                                4.8533184,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                50,
                                0,
                                5.1566508,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                10008,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                44,
                                4.2466536,
                                2.6216586,
                                0.422,
                                0.18697981,
                                4.549986,
                                2.6216586,
                                0.422,
                                0.18697981,
                                4.8533184,
                                2.6216586,
                                0.422,
                                0.18697981,
                                5.1566508,
                                2.6216586,
                                0.422,
                                0.18697981,
                                4.3983198,
                                2.8924911,
                                0.422,
                                0.18697981,
                                4.7016522,
                                2.8924911,
                                0.422,
                                0.18697981,
                                5.0049846,
                                2.8924911,
                                0.422,
                                0.18697981,
                                4.3983198,
                                2.7733248,
                                0.683,
                                0.18697981,
                                4.7016522,
                                2.7733248,
                                0.683,
                                0.18697981,
                                5.0049846,
                                2.7733248,
                                0.683,
                                0.18697981,
                                5.308317,
                                2.7733248,
                                0.683,
                                0.18697981,
                                1000,
                                10014,
                                2,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                92,
                                4.2466536,
                                3.1524903,
                                0.422,
                                0.18697981,
                                4.549986,
                                3.1524903,
                                0.422,
                                0.18697981,
                                4.8533184,
                                3.1524903,
                                0.422,
                                0.18697981,
                                5.1566508,
                                3.1524903,
                                0.422,
                                0.18697981,
                                4.3983198,
                                3.4124895,
                                0.422,
                                0.18697981,
                                4.7016522,
                                3.4124895,
                                0.422,
                                0.18697981,
                                5.0049846,
                                3.4124895,
                                0.422,
                                0.18697981,
                                5.308317,
                                3.4124895,
                                0.422,
                                0.18697981,
                                4.2466536,
                                3.6724887,
                                0.422,
                                0.18697981,
                                4.549986,
                                3.6724887,
                                0.422,
                                0.18697981,
                                4.8533184,
                                3.6724887,
                                0.422,
                                0.18697981,
                                5.1566508,
                                3.6724887,
                                0.422,
                                0.18697981,
                                4.549986,
                                3.0441573,
                                0.683,
                                0.18697981,
                                4.8533184,
                                3.0441573,
                                0.683,
                                0.18697981,
                                5.1566508,
                                3.0441573,
                                0.683,
                                0.18697981,
                                4.3983198,
                                3.3041565,
                                0.683,
                                0.18697981,
                                4.7016522,
                                3.3041565,
                                0.683,
                                0.18697981,
                                5.0049846,
                                3.3041565,
                                0.683,
                                0.18697981,
                                5.308317,
                                3.3041565,
                                0.683,
                                0.18697981,
                                4.2466536,
                                3.5641557,
                                0.683,
                                0.18697981,
                                4.549986,
                                3.5641557,
                                0.683,
                                0.18697981,
                                4.8533184,
                                3.5641557,
                                0.683,
                                0.18697981,
                                5.1566508,
                                3.5641557,
                                0.683,
                                0.18697981,
                                1000,
                                10025,
                                3,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                4.2466536,
                                3.0441573,
                                0.683,
                                0.18697981,
                                1000,
                                10002,
                                4,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                0,
                                0,
                                0,
                                0,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 36.0,
                            "data": [
                                1000.0,
                                35.0,
                                0.0,
                                4.3983198,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                36.0,
                                0.0,
                                4.701652200000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                37.0,
                                0.0,
                                5.0049846,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                38.0,
                                0.0,
                                5.308317000000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                39.0,
                                0.0,
                                4.2466536,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                40.0,
                                0.0,
                                4.5499860000000005,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                41.0,
                                0.0,
                                4.8533184,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                42.0,
                                0.0,
                                5.1566508,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                43.0,
                                0.0,
                                4.3983198,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                44.0,
                                0.0,
                                4.701652200000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                45.0,
                                0.0,
                                5.0049846,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                46.0,
                                0.0,
                                5.308317000000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                47.0,
                                0.0,
                                4.2466536,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                48.0,
                                0.0,
                                4.5499860000000005,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                49.0,
                                0.0,
                                4.8533184,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                50.0,
                                0.0,
                                5.1566508,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000,
                                10008,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                44,
                                4.25935415,
                                2.59675749,
                                0.46851525,
                                0.18809803,
                                4.54331971,
                                2.6057674,
                                0.4416345,
                                0.18809803,
                                4.85395935,
                                2.60636642,
                                0.43067869,
                                0.18809803,
                                5.1643596,
                                2.58387845,
                                0.41147082,
                                0.18809803,
                                4.36491455,
                                2.86295946,
                                0.41842861,
                                0.18809803,
                                4.7181739,
                                2.88203502,
                                0.45949203,
                                0.18809803,
                                5.00486352,
                                2.85795503,
                                0.40255897,
                                0.18809803,
                                4.39396739,
                                2.77117021,
                                0.66500912,
                                0.18809803,
                                4.70330812,
                                2.7277704,
                                0.67194047,
                                0.18809803,
                                4.99104176,
                                2.73972621,
                                0.66707701,
                                0.18809803,
                                5.31141145,
                                2.75504925,
                                0.59365464,
                                0.18809803,
                                1000,
                                10014,
                                2,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                92,
                                4.25076455,
                                3.16531826,
                                0.41513202,
                                0.18809803,
                                4.54779852,
                                3.16722814,
                                0.427802,
                                0.18809803,
                                4.86544647,
                                3.14067003,
                                0.45157985,
                                0.18809803,
                                5.19680283,
                                3.14568098,
                                0.39884846,
                                0.18809803,
                                4.40129395,
                                3.40372065,
                                0.42949631,
                                0.18809803,
                                4.7213326,
                                3.41977731,
                                0.4492001,
                                0.18809803,
                                5.02286716,
                                3.38583813,
                                0.47401068,
                                0.18809803,
                                5.30014487,
                                3.39509142,
                                0.41665032,
                                0.18809803,
                                4.26515823,
                                3.69957095,
                                0.42061832,
                                0.18809803,
                                4.55204183,
                                3.68030255,
                                0.45628205,
                                0.18809803,
                                4.87193765,
                                3.6940308,
                                0.47165251,
                                0.18809803,
                                5.18656377,
                                3.65932729,
                                0.43562286,
                                0.18809803,
                                4.58415313,
                                3.03268913,
                                0.71284966,
                                0.18809803,
                                4.88407047,
                                3.05968889,
                                0.70027232,
                                0.18809803,
                                5.14468788,
                                3.03399844,
                                0.66473778,
                                0.18809803,
                                4.40006178,
                                3.29221712,
                                0.69359224,
                                0.18809803,
                                4.71850713,
                                3.29656485,
                                0.68033242,
                                0.18809803,
                                5.01409862,
                                3.30394876,
                                0.69995531,
                                0.18809803,
                                5.32647093,
                                3.34342338,
                                0.643802,
                                0.18809803,
                                4.27097877,
                                3.56221851,
                                0.65158,
                                0.18809803,
                                4.55568603,
                                3.55444863,
                                0.69178993,
                                0.18809803,
                                4.86578711,
                                3.56051492,
                                0.69549859,
                                0.18809803,
                                5.16575112,
                                3.56738003,
                                0.71507144,
                                0.18809803,
                                1000,
                                10025,
                                3,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                4.22797133,
                                3.03325335,
                                0.74915296,
                                0.18809803,
                            ],
                        },
                        {
                            "frameNumber": 2,
                            "time": 72.0,
                            "data": [
                                1000.0,
                                35.0,
                                0.0,
                                4.3983198,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                36.0,
                                0.0,
                                4.701652200000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                37.0,
                                0.0,
                                5.0049846,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                38.0,
                                0.0,
                                5.308317000000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                39.0,
                                0.0,
                                4.2466536,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                40.0,
                                0.0,
                                4.5499860000000005,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                41.0,
                                0.0,
                                4.8533184,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                42.0,
                                0.0,
                                5.1566508,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                43.0,
                                0.0,
                                4.3983198,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                44.0,
                                0.0,
                                4.701652200000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                45.0,
                                0.0,
                                5.0049846,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                46.0,
                                0.0,
                                5.308317000000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                47.0,
                                0.0,
                                4.2466536,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                48.0,
                                0.0,
                                4.5499860000000005,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                49.0,
                                0.0,
                                4.8533184,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                50.0,
                                0.0,
                                5.1566508,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000,
                                10008,
                                1,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                44,
                                4.27025303,
                                2.54769096,
                                0.46623067,
                                0.1882706,
                                4.5505787,
                                2.63067099,
                                0.4386911,
                                0.1882706,
                                4.85996481,
                                2.59403897,
                                0.45042914,
                                0.1882706,
                                5.14669272,
                                2.55196243,
                                0.3944318,
                                0.1882706,
                                4.34408373,
                                2.84518282,
                                0.39410456,
                                0.1882706,
                                4.71588049,
                                2.87354765,
                                0.44874422,
                                0.1882706,
                                5.04637181,
                                2.83811507,
                                0.39719288,
                                0.1882706,
                                4.39687757,
                                2.75806538,
                                0.65469875,
                                0.1882706,
                                4.68990601,
                                2.68169079,
                                0.73978046,
                                0.1882706,
                                5.02771501,
                                2.71924465,
                                0.66449455,
                                0.1882706,
                                5.3058352,
                                2.77004038,
                                0.60360314,
                                0.1882706,
                                1000,
                                10014,
                                2,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                92,
                                4.25789182,
                                3.14415289,
                                0.40654814,
                                0.1882706,
                                4.57178604,
                                3.17419718,
                                0.40277723,
                                0.1882706,
                                4.89459838,
                                3.17012168,
                                0.42205552,
                                0.1882706,
                                5.20252872,
                                3.17224301,
                                0.38448582,
                                0.1882706,
                                4.40018098,
                                3.41453061,
                                0.4372122,
                                0.1882706,
                                4.71317084,
                                3.42627249,
                                0.46922841,
                                0.1882706,
                                5.01428221,
                                3.39107313,
                                0.47325566,
                                0.1882706,
                                5.31133529,
                                3.41070422,
                                0.43876747,
                                0.1882706,
                                4.27646935,
                                3.72502981,
                                0.40846233,
                                0.1882706,
                                4.59829332,
                                3.6901611,
                                0.45031399,
                                0.1882706,
                                4.91050621,
                                3.68936633,
                                0.43175474,
                                0.1882706,
                                5.22479285,
                                3.66662078,
                                0.47868125,
                                0.1882706,
                                4.58231584,
                                3.02328021,
                                0.69070156,
                                0.1882706,
                                4.89610996,
                                3.06645406,
                                0.6789944,
                                0.1882706,
                                5.16713155,
                                3.03751325,
                                0.71075286,
                                0.1882706,
                                4.41036451,
                                3.24939366,
                                0.70218187,
                                0.1882706,
                                4.75191,
                                3.31654484,
                                0.6982709,
                                0.1882706,
                                5.04482029,
                                3.29508226,
                                0.70262063,
                                0.1882706,
                                5.3424327,
                                3.30135212,
                                0.64091257,
                                0.1882706,
                                4.2843763,
                                3.53956014,
                                0.67511901,
                                0.1882706,
                                4.58501524,
                                3.5250841,
                                0.7108788,
                                0.1882706,
                                4.90436483,
                                3.57654431,
                                0.68008837,
                                0.1882706,
                                5.19989616,
                                3.5656171,
                                0.71678279,
                                0.1882706,
                                1000,
                                10025,
                                3,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                4.21487647,
                                3.04925178,
                                0.7672043,
                                0.1882706,
                            ],
                        },
                    ],
                },
                "plotData": {"version": CURRENT_VERSION.PLOT_DATA, "data": []},
            },
        ),
    ],
)
def test_physicell_converter(trajectory, expected_data):
    converter = PhysicellConverter(trajectory)
    buffer_data = JsonWriter.format_trajectory_data(converter._data)
    assert_buffers_equal(buffer_data, expected_data)
    assert JsonWriter._check_agent_ids_are_unique_per_frame(buffer_data)
