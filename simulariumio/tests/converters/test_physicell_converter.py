#!/usr/bin/env python
# -*- coding: utf-8 -*-

import numpy as np
import pytest

from simulariumio.physicell import PhysicellConverter, PhysicellData
from simulariumio import MetaData, DisplayData, JsonWriter, DISPLAY_TYPE, UnitData
from simulariumio.constants import (
    DEFAULT_CAMERA_SETTINGS,
    CURRENT_VERSION,
    DEFAULT_COLORS,
)
from simulariumio.tests.conftest import assert_buffers_equal


@pytest.mark.parametrize(
    "trajectory, expected_data",
    [
        # 3 cells 3 frames
        (
            PhysicellData(
                meta_data=MetaData(
                    box_size=np.array([1000.0, 1000.0, 100.0]),
                    scale_factor=0.01,
                ),
                timestep=360.0,
                path_to_output_dir="simulariumio/tests/data/physicell/default_output/",
                display_data={
                    0: DisplayData(
                        name="Cancer cell",
                        display_type=DISPLAY_TYPE.SPHERE,
                        radius=30.0,
                        color="#0080ff",
                    ),
                },
                phase_names={1: {4: "interphase"}},
            ),
            {
                "trajectoryInfo": {
                    "version": CURRENT_VERSION.TRAJECTORY_INFO,
                    "timeUnits": {
                        "magnitude": 1.0,
                        "name": "s",
                    },
                    "timeStepSize": 360.0,
                    "totalSteps": 3,
                    "spatialUnits": {
                        "magnitude": 100.0,
                        "name": "µm",
                    },
                    "size": {"x": 10.0, "y": 10.0, "z": 1.0},
                    "cameraDefault": {
                        "position": {
                            "x": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[2],
                        },
                        "lookAtPosition": {
                            "x": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[2],
                        },
                        "upVector": {
                            "x": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[0],
                            "y": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[1],
                            "z": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[2],
                        },
                        "fovDegrees": DEFAULT_CAMERA_SETTINGS.FOV_DEGREES,
                    },
                    "typeMapping": {
                        "0": {
                            "name": "cell1#interphase",
                            "geometry": {
                                "displayType": "SPHERE",
                            },
                        },
                        "1": {
                            "name": "Cancer cell#phase4",
                            "geometry": {
                                "displayType": "SPHERE",
                                "color": "#0080ff",
                            },
                        },
                    },
                },
                "spatialData": {
                    "version": CURRENT_VERSION.SPATIAL_DATA,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 3,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -4.2700000000000005,
                                -2.5100000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 360.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -4.247925822013689,
                                -2.386576945662163,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                        {
                            "frameNumber": 2,
                            "time": 720.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -3.993800168730208,
                                -2.5387508185531873,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                    ],
                },
                "plotData": {"version": CURRENT_VERSION.PLOT_DATA, "data": []},
            },
        ),
        # 3 cells 1 frame
        (
            PhysicellData(
                timestep=360.0,
                path_to_output_dir="simulariumio/tests/data/physicell/default_output/",
                meta_data=MetaData(
                    box_size=np.array([1000.0, 1000.0, 100.0]),
                    scale_factor=0.01,
                ),
                nth_timestep_to_read=2,
                display_data={
                    0: DisplayData(
                        name="Cancer cell",
                        display_type=DISPLAY_TYPE.SPHERE,
                        radius=30.0,
                        color="#0080ff",
                    ),
                },
                phase_names={1: {4: "interphase"}},
            ),
            {
                "trajectoryInfo": {
                    "version": CURRENT_VERSION.TRAJECTORY_INFO,
                    "timeUnits": {
                        "magnitude": 1.0,
                        "name": "s",
                    },
                    "timeStepSize": 720.0,
                    "totalSteps": 2,
                    "spatialUnits": {
                        "magnitude": 100.0,
                        "name": "µm",
                    },
                    "size": {"x": 10.0, "y": 10.0, "z": 1.0},
                    "cameraDefault": {
                        "position": {
                            "x": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[2],
                        },
                        "lookAtPosition": {
                            "x": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[2],
                        },
                        "upVector": {
                            "x": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[0],
                            "y": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[1],
                            "z": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[2],
                        },
                        "fovDegrees": DEFAULT_CAMERA_SETTINGS.FOV_DEGREES,
                    },
                    "typeMapping": {
                        "0": {
                            "name": "cell1#interphase",
                            "geometry": {
                                "displayType": "SPHERE",
                            },
                        },
                        "1": {
                            "name": "Cancer cell#phase4",
                            "geometry": {
                                "displayType": "SPHERE",
                                "color": "#0080ff",
                            },
                        },
                    },
                },
                "spatialData": {
                    "version": CURRENT_VERSION.SPATIAL_DATA,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 2,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -4.2700000000000005,
                                -2.5100000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 720.0,
                            "data": [
                                1000.0,
                                0.0,
                                0.0,
                                -3.993800168730208,
                                -2.5387508185531873,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.08412710547954229,
                                0.0,
                                1000.0,
                                1.0,
                                1.0,
                                -2.2800000000000002,
                                4.3,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                                1000.0,
                                2.0,
                                1.0,
                                4.23,
                                3.7800000000000002,
                                0.0,
                                0.0,
                                0.0,
                                0.0,
                                0.3,
                                0.0,
                            ],
                        },
                    ],
                },
                "plotData": {"version": CURRENT_VERSION.PLOT_DATA, "data": []},
            },
        ),
        # path_to_output_dir is incorrect
        pytest.param(
            {
                "meta_data": MetaData(
                    box_size=np.array([1000.0, 1000.0, 100.0]),
                    scale_factor=0.01,
                ),
                "timestep": 360.0,
                "path_to_output_dir": "../simulariumio/tests/data/physicell/",
            },
            {},
            marks=pytest.mark.raises(exception=AttributeError),
        ),
        # sphere groups for owner cells and subcells
        (
            PhysicellData(
                meta_data=MetaData(
                    box_size=np.array([960.0, 640.0, 300.0]),
                    scale_factor=0.01,
                ),
                timestep=36.0,
                path_to_output_dir="simulariumio/tests/data/physicell/subcell_output/",
                display_data={
                    0: DisplayData(
                        name="Substrate",
                        display_type=DISPLAY_TYPE.SPHERE,
                        color="#d0c5c8",
                    ),
                },
                phase_names={0: {18: "fixed"}},
                max_owner_cells=10000,
                owner_cell_display_name="Stem cell",
                time_units=UnitData("min"),
            ),
            {
                "trajectoryInfo": {
                    "version": CURRENT_VERSION.TRAJECTORY_INFO,
                    "timeUnits": {
                        "magnitude": 1.0,
                        "name": "min",
                    },
                    "timeStepSize": 36.0,
                    "totalSteps": 3,
                    "spatialUnits": {
                        "magnitude": 100.0,
                        "name": "µm",
                    },
                    "size": {"x": 9.6, "y": 6.4, "z": 3.0},
                    "cameraDefault": {
                        "position": {
                            "x": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.CAMERA_POSITION[2],
                        },
                        "lookAtPosition": {
                            "x": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[0],
                            "y": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[1],
                            "z": DEFAULT_CAMERA_SETTINGS.LOOK_AT_POSITION[2],
                        },
                        "upVector": {
                            "x": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[0],
                            "y": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[1],
                            "z": DEFAULT_CAMERA_SETTINGS.UP_VECTOR[2],
                        },
                        "fovDegrees": DEFAULT_CAMERA_SETTINGS.FOV_DEGREES,
                    },
                    "typeMapping": {
                        "0": {
                            "name": "Substrate#fixed",
                            "geometry": {
                                "displayType": "SPHERE",
                                "color": "#d0c5c8",
                            },
                        },
                        "1": {
                            "name": "Stem cell#8",
                            "geometry": {
                                "displayType": "SPHERE_GROUP",
                                "color": DEFAULT_COLORS[0],
                            },
                        },
                        "2": {
                            "name": "Stem cell#14",
                            "geometry": {
                                "displayType": "SPHERE_GROUP",
                                "color": DEFAULT_COLORS[1],
                            },
                        },
                        "3": {
                            "name": "Stem cell#25",
                            "geometry": {
                                "displayType": "SPHERE_GROUP",
                                "color": DEFAULT_COLORS[2],
                            },
                        },
                        "4": {
                            "name": "Stem cell#2",
                            "geometry": {
                                "displayType": "SPHERE_GROUP",
                                "color": DEFAULT_COLORS[3],
                            },
                        },
                    },
                },
                "spatialData": {
                    "version": CURRENT_VERSION.SPATIAL_DATA,
                    "msgType": 1,
                    "bundleStart": 0,
                    "bundleSize": 3,
                    "bundleData": [
                        {
                            "frameNumber": 0,
                            "time": 0.0,
                            "data": [
                                1000,
                                35,
                                0,
                                4.3983198,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                36,
                                0,
                                4.701652200000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                37,
                                0,
                                5.0049846,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                38,
                                0,
                                5.308317000000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                39,
                                0,
                                4.2466536,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                40,
                                0,
                                4.5499860000000005,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                41,
                                0,
                                4.8533184,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                42,
                                0,
                                5.1566508,
                                3.0441573,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                43,
                                0,
                                4.3983198,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                44,
                                0,
                                4.701652200000001,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                45,
                                0,
                                5.0049846,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                46,
                                0,
                                5.308317000000001,
                                3.3041565,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                47,
                                0,
                                4.2466536,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                48,
                                0,
                                4.5499860000000005,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                49,
                                0,
                                4.8533184,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                50,
                                0,
                                5.1566508,
                                3.5641557,
                                0.16099999999999998,
                                0,
                                0,
                                0,
                                0.18837494593627718,
                                0,
                                1000,
                                10008,
                                1,
                                4.756803545454546,
                                2.750673354545455,
                                0.5169090909090909,
                                0,
                                0,
                                0,
                                1.0,
                                44,
                                -0.510149945454546,
                                -0.1290147545454552,
                                -0.09490909090909089,
                                0.18697981,
                                -0.20681754545454645,
                                -0.1290147545454552,
                                -0.09490909090909089,
                                0.18697981,
                                0.09651485454545394,
                                -0.1290147545454552,
                                -0.09490909090909089,
                                0.18697981,
                                0.39984725454545433,
                                -0.1290147545454552,
                                -0.09490909090909089,
                                0.18697981,
                                -0.35848374545454575,
                                0.14181774545454484,
                                -0.09490909090909089,
                                0.18697981,
                                -0.05515134545454625,
                                0.14181774545454484,
                                -0.09490909090909089,
                                0.18697981,
                                0.24818105454545414,
                                0.14181774545454484,
                                -0.09490909090909089,
                                0.18697981,
                                -0.35848374545454575,
                                0.022651445454545005,
                                0.16609090909090918,
                                0.18697981,
                                -0.05515134545454625,
                                0.022651445454545005,
                                0.16609090909090918,
                                0.18697981,
                                0.24818105454545414,
                                0.022651445454545005,
                                0.16609090909090918,
                                0.18697981,
                                0.5515134545454536,
                                0.022651445454545005,
                                0.16609090909090918,
                                0.18697981,
                                1000,
                                10014,
                                2,
                                4.774188208695653,
                                3.3719823782608698,
                                0.5468260869565217,
                                0,
                                0,
                                0,
                                1.0,
                                92,
                                -0.5275346086956532,
                                -0.21949207826086958,
                                -0.1248260869565217,
                                0.18697981,
                                -0.22420220869565366,
                                -0.21949207826086958,
                                -0.1248260869565217,
                                0.18697981,
                                0.07913019130434673,
                                -0.21949207826086958,
                                -0.1248260869565217,
                                0.18697981,
                                0.3824625913043471,
                                -0.21949207826086958,
                                -0.1248260869565217,
                                0.18697981,
                                -0.37586840869565297,
                                0.04050712173913018,
                                -0.1248260869565217,
                                0.18697981,
                                -0.07253600869565346,
                                0.04050712173913018,
                                -0.1248260869565217,
                                0.18697981,
                                0.23079639130434693,
                                0.04050712173913018,
                                -0.1248260869565217,
                                0.18697981,
                                0.5341287913043464,
                                0.04050712173913018,
                                -0.1248260869565217,
                                0.18697981,
                                -0.5275346086956532,
                                0.3005063217391304,
                                -0.1248260869565217,
                                0.18697981,
                                -0.22420220869565366,
                                0.3005063217391304,
                                -0.1248260869565217,
                                0.18697981,
                                0.07913019130434673,
                                0.3005063217391304,
                                -0.1248260869565217,
                                0.18697981,
                                0.3824625913043471,
                                0.3005063217391304,
                                -0.1248260869565217,
                                0.18697981,
                                -0.22420220869565366,
                                -0.3278250782608696,
                                0.13617391304347837,
                                0.18697981,
                                0.07913019130434673,
                                -0.3278250782608696,
                                0.13617391304347837,
                                0.18697981,
                                0.3824625913043471,
                                -0.3278250782608696,
                                0.13617391304347837,
                                0.18697981,
                                -0.37586840869565297,
                                -0.06782587826086983,
                                0.13617391304347837,
                                0.18697981,
                                -0.07253600869565346,
                                -0.06782587826086983,
                                0.13617391304347837,
                                0.18697981,
                                0.23079639130434693,
                                -0.06782587826086983,
                                0.13617391304347837,
                                0.18697981,
                                0.5341287913043464,
                                -0.06782587826086983,
                                0.13617391304347837,
                                0.18697981,
                                -0.5275346086956532,
                                0.19217332173913038,
                                0.13617391304347837,
                                0.18697981,
                                -0.22420220869565366,
                                0.19217332173913038,
                                0.13617391304347837,
                                0.18697981,
                                0.07913019130434673,
                                0.19217332173913038,
                                0.13617391304347837,
                                0.18697981,
                                0.3824625913043471,
                                0.19217332173913038,
                                0.13617391304347837,
                                0.18697981,
                                1000,
                                10025,
                                3,
                                4.2466536,
                                3.0441573,
                                0.6829999999999999,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                0,
                                0,
                                0,
                                0.18697981,
                                1000,
                                10002,
                                4,
                                0,
                                0,
                                0,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                0,
                                0,
                                0,
                                0,
                            ],
                        },
                        {
                            "frameNumber": 1,
                            "time": 36.0,
                            "data": [
                                1000.0,
                                35.0,
                                0.0,
                                4.3983198,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                36.0,
                                0.0,
                                4.701652200000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                37.0,
                                0.0,
                                5.0049846,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                38.0,
                                0.0,
                                5.308317000000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                39.0,
                                0.0,
                                4.2466536,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                40.0,
                                0.0,
                                4.5499860000000005,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                41.0,
                                0.0,
                                4.8533184,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                42.0,
                                0.0,
                                5.1566508,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                43.0,
                                0.0,
                                4.3983198,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                44.0,
                                0.0,
                                4.701652200000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                45.0,
                                0.0,
                                5.0049846,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                46.0,
                                0.0,
                                5.308317000000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                47.0,
                                0.0,
                                4.2466536,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                48.0,
                                0.0,
                                4.5499860000000005,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                49.0,
                                0.0,
                                4.8533184,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                50.0,
                                0.0,
                                5.1566508,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000,
                                10008,
                                1,
                                4.755333955318625,
                                2.7263123028751712,
                                0.5118600096509627,
                                0,
                                0,
                                0,
                                1.0,
                                44,
                                -0.4959798053186253,
                                -0.12955481287517134,
                                -0.04334475965096268,
                                0.18809803,
                                -0.21201424531862578,
                                -0.12054490287517128,
                                -0.07022550965096269,
                                0.18809803,
                                0.09862539468137488,
                                -0.11994588287517116,
                                -0.0811813196509627,
                                0.18809803,
                                0.4090256446813747,
                                -0.1424338528751714,
                                -0.10038918965096266,
                                0.18809803,
                                -0.3904194053186254,
                                0.13664715712482867,
                                -0.0934313996509627,
                                0.18809803,
                                -0.03716005531862532,
                                0.15572271712482877,
                                -0.05236797965096268,
                                0.18809803,
                                0.24952956468137444,
                                0.1316427271248286,
                                -0.10930103965096266,
                                0.18809803,
                                -0.3613665653186251,
                                0.044857907124828955,
                                0.15314911034903733,
                                0.18809803,
                                -0.05202583531862537,
                                0.0014580971248285834,
                                0.16008046034903733,
                                0.18809803,
                                0.23570780468137453,
                                0.013413907124828928,
                                0.1552170003490373,
                                0.18809803,
                                0.5560774946813742,
                                0.02873694712482866,
                                0.08179463034903733,
                                0.18809803,
                                1000,
                                10014,
                                2,
                                4.787495886715849,
                                3.3723325732242633,
                                0.5563642249839672,
                                0,
                                0,
                                0,
                                1.0,
                                92,
                                -0.5367313367158486,
                                -0.20701431322426345,
                                -0.1412322049839672,
                                0.18809803,
                                -0.2396973667158493,
                                -0.20510443322426308,
                                -0.1285622249839672,
                                0.18809803,
                                0.07795058328415116,
                                -0.23166254322426338,
                                -0.1047843749839672,
                                0.18809803,
                                0.4093069432841512,
                                -0.22665159322426343,
                                -0.1575157649839672,
                                0.18809803,
                                -0.3862019367158487,
                                0.03138807677573663,
                                -0.1268679149839672,
                                0.18809803,
                                -0.06616328671584881,
                                0.047444736775736907,
                                -0.10716412498396721,
                                0.18809803,
                                0.23537127328415064,
                                0.013505556775736505,
                                -0.08235354498396719,
                                0.18809803,
                                0.5126489832841505,
                                0.022758846775736696,
                                -0.13971390498396719,
                                0.18809803,
                                -0.5223376567158491,
                                0.32723837677573675,
                                -0.1357459049839672,
                                0.18809803,
                                -0.23545405671584874,
                                0.3079699767757367,
                                -0.10008217498396721,
                                0.18809803,
                                0.08444176328415054,
                                0.3216982267757369,
                                -0.08471171498396718,
                                0.18809803,
                                0.3990678832841512,
                                0.2869947167757365,
                                -0.1207413649839672,
                                0.18809803,
                                -0.20334275671584923,
                                -0.3396434432242632,
                                0.15648543501603285,
                                0.18809803,
                                0.09657458328415114,
                                -0.3126436832242634,
                                0.14390809501603274,
                                0.18809803,
                                0.3571919932841512,
                                -0.3383341332242633,
                                0.10837355501603274,
                                0.18809803,
                                -0.3874341067158493,
                                -0.08011545322426317,
                                0.13722801501603277,
                                0.18809803,
                                -0.06898875671584914,
                                -0.07576772322426306,
                                0.12396819501603284,
                                0.18809803,
                                0.22660273328415137,
                                -0.06838381322426335,
                                0.1435910850160328,
                                0.18809803,
                                0.5389750432841511,
                                -0.02890919322426333,
                                0.08743777501603278,
                                0.18809803,
                                -0.5165171167158489,
                                0.18988593677573684,
                                0.09521577501603284,
                                0.18809803,
                                -0.23180985671584864,
                                0.18211605677573672,
                                0.1354257050160328,
                                0.18809803,
                                0.07829122328415128,
                                0.18818234677573686,
                                0.13913436501603282,
                                0.18809803,
                                0.37825523328415134,
                                0.19504745677573654,
                                0.1587072150160328,
                                0.18809803,
                                1000,
                                10025,
                                3,
                                4.22797133,
                                3.03325335,
                                0.74915296,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                0,
                                0,
                                0,
                                0.18809803,
                            ],
                        },
                        {
                            "frameNumber": 2,
                            "time": 72.0,
                            "data": [
                                1000.0,
                                35.0,
                                0.0,
                                4.3983198,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                36.0,
                                0.0,
                                4.701652200000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                37.0,
                                0.0,
                                5.0049846,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                38.0,
                                0.0,
                                5.308317000000001,
                                2.7733247999999997,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                39.0,
                                0.0,
                                4.2466536,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                40.0,
                                0.0,
                                4.5499860000000005,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                41.0,
                                0.0,
                                4.8533184,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                42.0,
                                0.0,
                                5.1566508,
                                3.0441573,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                43.0,
                                0.0,
                                4.3983198,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                44.0,
                                0.0,
                                4.701652200000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                45.0,
                                0.0,
                                5.0049846,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                46.0,
                                0.0,
                                5.308317000000001,
                                3.3041565,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                47.0,
                                0.0,
                                4.2466536,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                48.0,
                                0.0,
                                4.5499860000000005,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                49.0,
                                0.0,
                                4.8533184,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000.0,
                                50.0,
                                0.0,
                                5.1566508,
                                3.5641557,
                                0.16099999999999998,
                                0.0,
                                0.0,
                                0.0,
                                0.18837494593627718,
                                0.0,
                                1000,
                                10008,
                                1,
                                4.759469007632346,
                                2.710022734301882,
                                0.5138546602365159,
                                0,
                                0,
                                0,
                                1.0,
                                44,
                                -0.4892159776323455,
                                -0.16233177430188173,
                                -0.04762399023651592,
                                0.1882706,
                                -0.20889030763234562,
                                -0.07935174430188185,
                                -0.07516356023651594,
                                0.1882706,
                                0.10049580236765454,
                                -0.11598376430188173,
                                -0.06342552023651593,
                                0.1882706,
                                0.3872237123676543,
                                -0.15806030430188178,
                                -0.11942286023651594,
                                0.1882706,
                                -0.41538527763234523,
                                0.13516008569811788,
                                -0.11975010023651594,
                                0.1882706,
                                -0.043588517632345614,
                                0.163524915698118,
                                -0.06511044023651591,
                                0.1882706,
                                0.28690280236765453,
                                0.1280923356981183,
                                -0.11666178023651591,
                                0.1882706,
                                -0.3625914376323456,
                                0.048042645698118225,
                                0.14084408976348406,
                                0.1882706,
                                -0.06956299763234597,
                                -0.028331944301881684,
                                0.22592579976348404,
                                0.1882706,
                                0.26824600236765406,
                                0.009221915698117922,
                                0.15063988976348408,
                                0.1882706,
                                0.5463661923676542,
                                0.060017645698118294,
                                0.0897484797634841,
                                0.1882706,
                                1000,
                                10014,
                                2,
                                4.806285799240596,
                                3.3726477958587093,
                                0.556993326654809,
                                0,
                                0,
                                0,
                                1.0,
                                92,
                                -0.5483939792405961,
                                -0.22849490585870935,
                                -0.15044518665480905,
                                0.1882706,
                                -0.23449975924059618,
                                -0.19845061585870916,
                                -0.15421609665480907,
                                0.1882706,
                                0.0883125807594034,
                                -0.2025261158587095,
                                -0.13493780665480903,
                                0.1882706,
                                0.3962429207594038,
                                -0.20040478585870947,
                                -0.17250750665480907,
                                0.1882706,
                                -0.40610481924059627,
                                0.04188281414129058,
                                -0.11978112665480906,
                                0.1882706,
                                -0.0931149592405962,
                                0.053624694141290785,
                                -0.08776491665480907,
                                0.1882706,
                                0.2079964107594039,
                                0.018425334141290772,
                                -0.08373766665480903,
                                0.1882706,
                                0.5050494907594034,
                                0.03805642414129062,
                                -0.11822585665480906,
                                0.1882706,
                                -0.5298164492405961,
                                0.3523820141412908,
                                -0.14853099665480907,
                                0.1882706,
                                -0.2079924792405965,
                                0.31751330414129075,
                                -0.10667933665480905,
                                0.1882706,
                                0.10422041075940403,
                                0.3167185341412906,
                                -0.12523858665480903,
                                0.1882706,
                                0.41850705075940375,
                                0.2939729841412908,
                                -0.07831207665480905,
                                0.1882706,
                                -0.2239699592405966,
                                -0.34936758585870953,
                                0.133708233345191,
                                0.1882706,
                                0.08982416075940414,
                                -0.30619373585870946,
                                0.12200107334519095,
                                0.1882706,
                                0.3608457507594034,
                                -0.3351345458587094,
                                0.153759533345191,
                                0.1882706,
                                -0.39592128924059633,
                                -0.12325413585870937,
                                0.14518854334519093,
                                0.1882706,
                                -0.054375799240596656,
                                -0.05610295585870917,
                                0.14127757334519098,
                                0.1882706,
                                0.23853449075940336,
                                -0.07756553585870929,
                                0.14562730334519092,
                                0.1882706,
                                0.5361469007594035,
                                -0.07129567585870955,
                                0.08391924334519096,
                                0.1882706,
                                -0.5219094992405964,
                                0.16691234414129053,
                                0.11812568334519091,
                                0.1882706,
                                -0.22127055924059658,
                                0.1524363041412906,
                                0.15388547334519098,
                                0.1882706,
                                0.09807903075940327,
                                0.20389651414129073,
                                0.12309504334519095,
                                0.1882706,
                                0.3936103607594035,
                                0.19296930414129054,
                                0.15978946334519095,
                                0.1882706,
                                1000,
                                10025,
                                3,
                                4.21487647,
                                3.04925178,
                                0.7672043,
                                0,
                                0,
                                0,
                                1.0,
                                4,
                                0,
                                0,
                                0,
                                0.1882706,
                            ],
                        },
                    ],
                },
                "plotData": {"version": CURRENT_VERSION.PLOT_DATA, "data": []},
            },
        ),
    ],
)
def test_physicell_converter(trajectory, expected_data):
    converter = PhysicellConverter(trajectory)
    buffer_data = JsonWriter.format_trajectory_data(converter._data)
    assert_buffers_equal(buffer_data, expected_data)
    assert JsonWriter._check_agent_ids_are_unique_per_frame(buffer_data)
